<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>

<div class="equipes-container">
  <!-- Header -->
  <div class="header">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <h1>Equipes</h1>
    <button class="btn-primary" (click)="toggleForm()">
      <i class="pi pi-plus-circle mr-2"></i> Ajouter equipe
    </button>
  </div>


<p-dialog
  [draggable]="false"
  [(visible)]="showForm"
  [style]="{ width: '700px', height: '1000px' }"
  [header]="isEditing ? 'Modifier l\'√©quipe' : 'Ajouter une nouvelle √©quipe'"
  [modal]="true"
  [closable]="false"
>
  <ng-template #content>
    <form [formGroup]="teamForm" (ngSubmit)="saveTeam()" class="flex flex-col gap-6">

      <!-- ‚úÖ Section √âQUIPE -->
      <div>
        <h3 class="text-lg font-bold border-b pb-1 text-green-700">Equipe</h3>
      </div>

      <div class="flex gap-4">
        <!-- Nom -->
        <div class="w-1/2">
          <label for="name" class="block font-bold mb-2">Nom <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            id="name"
            formControlName="name"
            placeholder="Nom de l'√©quipe"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="teamForm.get('name')?.invalid && teamForm.get('name')?.touched">
            Le nom est requis.
          </small>
        </div>

        <!-- Abr√©viation -->
        <div class="w-1/2">
          <label for="abbreviation" class="block font-bold mb-2">Abr√©viation</label>
          <input
            pInputText
            type="text"
            id="abbreviation"
            formControlName="abbreviation"
            placeholder="Abr√©viation"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="teamForm.get('abbreviation')?.invalid && teamForm.get('abbreviation')?.touched">
            L'abr√©viation est requise.
          </small>
        </div>
      </div>


        <!-- Ville -->
        <div class="w-full">
          <label for="ville" class="block font-bold mb-2">Ville <span class="text-red-500">*</span></label>
          <p-select
            id="ville"
            formControlName="city_id"
            [options]="villes"
            optionLabel="name"
            optionValue="id"
            placeholder="S√©lectionnez une ville"
            class="w-full"
            appendTo="body"
          ></p-select>
          <small class="text-red-500" *ngIf="teamForm.get('city_id')?.invalid && teamForm.get('city_id')?.touched">
            La ville est requise.
          </small>
        </div>

        <!-- Logo -->
        <div class="w-full">
          <label for="logo" class="block font-bold mb-2">Logo</label>
          <div *ngIf="isEditing && currentLogo" class="mb-2">
            <p class="text-gray-600 text-sm mb-1">Logo actuel :</p>
            <img [src]="currentLogo" alt="Logo actuel" class="w-16 h-16 object-cover rounded shadow" />
          </div>
          <p-fileupload
            name="logo"
            [customUpload]="true"
            [auto]="false"
            accept="image/*"
            maxFileSize="1000000"
            chooseLabel="Choisir un fichier"
            chooseIcon="pi pi-upload"
            (onSelect)="onFileSelect($event)"
            [showUploadButton]="false"
            [showCancelButton]="false"
            [mode]="'advanced'"
          >
            <ng-template #empty>
              <div>Glisser le fichier ici</div>
            </ng-template>
          </p-fileupload>
          <small class="text-gray-500">Formats : JPG, PNG, etc.</small>
        </div>


      <!-- ‚úÖ Section RESPONSABLE -->
      <div>
        <h3 class="text-lg font-bold border-b pb-1 text-green-700">Responsable de l'√©quipe</h3>
      </div>

      <div class="flex gap-4">
        <!-- Pr√©nom -->
        <div class="w-1/2">
          <label for="manager_first_name" class="block font-bold mb-2">Pr√©nom <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            id="manager_first_name"
            formControlName="manager_first_name"
            placeholder="Pr√©nom"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="teamForm.get('manager_first_name')?.invalid && teamForm.get('manager_first_name')?.touched">
            Le pr√©nom est requis.
          </small>
        </div>

        <!-- Nom -->
        <div class="w-1/2">
          <label for="manager_last_name" class="block font-bold mb-2">Nom <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            id="manager_last_name"
            formControlName="manager_last_name"
            placeholder="Nom"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="teamForm.get('manager_last_name')?.invalid && teamForm.get('manager_last_name')?.touched">
            Le nom est requis.
          </small>
        </div>
      </div>

      <div class="flex gap-4">
        <!-- T√©l√©phone -->
        <div class="w-1/2">
          <label for="phone" class="block font-bold mb-2">T√©l√©phone <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="tel"
            id="phone"
            formControlName="phone"
            placeholder="Ex: 70000000"
            class="w-full"

          />
          <small class="text-red-500" *ngIf="teamForm.get('phone')?.invalid && teamForm.get('phone')?.touched">
            Le t√©l√©phone est requis.
          </small>
        </div>

        <!-- Email -->
        <div class="w-1/2">
          <label for="email" class="block font-bold mb-2">Email <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="email"
            id="email"
            formControlName="email"
            placeholder="ex: responsable@email.com"
            class="w-full"
          />
          <small class="text-red-500" *ngIf="teamForm.get('email')?.hasError('required') && teamForm.get('email')?.touched">
            L'email est requis.
          </small>
            <small class="text-red-500" *ngIf="teamForm.get('email')?.hasError('email') && teamForm.get('email')?.touched">
                Email invalide.
            </small>
        </div>
      </div>
        <!-- Poste du responsable -->
        <div class="w-full">
          <label for="role" class="block font-bold mb-2">Poste </label>
          <input
            pInputText
            type="text"
            id="manager_role"
            formControlName="manager_role"
            placeholder="Poste"
            class="w-full"
          />
        </div>

    </form>
  </ng-template>

  <ng-template #footer>
    <div class="flex justify-end gap-2">
      <p-button
        label="Annuler"
        icon="pi pi-times"
        severity="secondary"
        (click)="toggleForm()"
      />
      <p-button
        [label]="isEditing ? 'Modifier' : 'Enregistrer'"
        icon="pi pi-check"
        type="submit"
        form="equipeForm"
        (click)="saveTeam()"
      />
    </div>
  </ng-template>
</p-dialog>


  <p-dialog
[draggable]="false"
  header="D√©tails de l'√©quipe"
  styleClass="custom-green-header"
  [(visible)]="showDetails"
  [modal]="true"
  [style]="{ width: '500px', 'max-width': '95vw' }"
  [closable]="true"
  [contentStyle]="{ 'padding': '1.5rem', 'background-color': '#ffffff' }"
  [baseZIndex]="10000"

>
  <div *ngIf="selectedTeam" class="team-details-container">
    <!-- Titre principal comme sur le stade -->
    <h2 style="margin-bottom: 1rem; color: rgb(50,145,87); font-size: 1.5rem; text-align: center;">
      {{ selectedTeam.name }}
    </h2>

    <div class="team-logo-container" *ngIf="selectedTeam.logo">
      <img [src]="selectedTeam.logo" alt="Logo de l'√©quipe" class="team-logo" />
    </div>

    <div class="team-info">
      <p><strong>Abr√©viation :</strong> {{ selectedTeam.abbreviation || '-' }}</p>
      <p><strong>Email :</strong> {{ selectedTeam.email || '-' }}</p>
      <p><strong>T√©l√©phone :</strong> {{ selectedTeam.phone || '-' }}</p>
      <p><strong>Ville :</strong> {{ getCityNameById(selectedTeam.city_id) || '-' }}</p>
    </div>
  </div>
</p-dialog>

  <!-- Search -->
  <div class="search-container">
    <input
      type="text"
      class="search-input"
      [(ngModel)]="searchTerm"
      placeholder="Rechercher par nom de equipe..."
    >
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    Chargement des equipes...
  </div>

  <!-- Table -->
  <div *ngIf="!loading && filteredTeams.length > 0" class="table-container">
    <table class="equipes-table">
      <thead>
        <tr>
          <th>Nom Des Equipe</th>

          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let team of filteredTeams">
          <td class="equipe-nom">{{ team.name }}</td>

          <td class="actions">
            <div class="btn-group">
              <button class="btn btn-warning" (click)="editTeam(team)"><i class="pi pi-pencil"></i></button>
              <button class="btn btn-info" (click)="viewTeamDetails(team)"> <i class="pi pi-eye"></i></button>
              <button class="btn btn-danger" (click)="deleteTeam(team.id!)"><i class="pi pi-trash"></i></button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No results -->
  <div *ngIf="!loading && filteredTeams.length === 0 && searchTerm && teams.length > 0" class="no-results">
    <div class="icon">üîç</div>
    <p>Aucun equipe trouv√© pour "{{ searchTerm }}"</p>
  </div>
</div>
