# üîç Guide des Logs de Debug - Coach

## üìã Vue d'ensemble

Des logs d√©taill√©s ont √©t√© ajout√©s pour tracer le flux de donn√©es lors de la connexion d'un coach.

---

## üîê Logs d'Authentification

### Lors de la connexion (Login)

Ouvrez la console du navigateur (F12) et vous verrez :

```
üîê [AUTH] R√©ponse compl√®te du backend: { ... }
üë§ [AUTH] User re√ßu: { id, email, first_name, ... }
üè∑Ô∏è [AUTH] User ID: "abc-123"
üèüÔ∏è [AUTH] Team ID: "team-456"
üëî [AUTH] Coach ID: "coach-789"
‚úÖ [AUTH] Is Coach: true
üìã [AUTH] Roles: [{ slug: "coach", name: "Coach", ... }]
üîë [AUTH] Token: Token pr√©sent
```

### ‚úÖ Que v√©rifier :

1. **Team ID pr√©sent** - Le `team_id` doit √™tre une cha√Æne non vide
2. **Is Coach = true** - Confirme que l'utilisateur est un coach
3. **Token pr√©sent** - Le JWT est bien retourn√©
4. **Structure de l'objet User** - Noter les champs disponibles

### ‚ùå Probl√®mes courants :

**Probl√®me :** `Team ID: undefined`
```
üëî [AUTH] Team ID: undefined
```
**Solution :** Le backend ne retourne pas `team_id` dans l'objet user. V√©rifier l'API `/auth/login`.

**Probl√®me :** `Is Coach: false` ou `undefined`
```
‚úÖ [AUTH] Is Coach: false
```
**Solution :** Le champ `is_coach` n'est pas d√©fini ou est faux. V√©rifier les donn√©es utilisateur.

---

## üìä Logs du Dashboard

### Chargement des donn√©es du coach

```
üìä [DASHBOARD] Chargement des donn√©es du coach
üë§ [DASHBOARD] Current User: { id, team_id, ... }
üèüÔ∏è [DASHBOARD] Team ID √† utiliser: "team-456"
üÜî [DASHBOARD] Team ID depuis @Input: undefined
üÜî [DASHBOARD] Team ID depuis user: "team-456"
üîÑ [DASHBOARD] Appel API GET /teams/team-456
```

### Service EquipeService

```
üîÑ [EQUIPE SERVICE] GET /teams/team-456
üì• [EQUIPE SERVICE] R√©ponse brute du backend: { status, data, message }
‚úÖ [EQUIPE SERVICE] Extraction: res.data.team
```

### R√©ception des donn√©es

```
‚úÖ [DASHBOARD] √âquipe re√ßue du backend: { id, name, logo, ... }
üì¶ [DASHBOARD] Team Data format√©e: { id, name, coach, ... }
```

### ‚úÖ Que v√©rifier :

1. **Team ID correct** - Le m√™me ID que celui du login
2. **R√©ponse du backend** - Structure de la r√©ponse API
3. **Extraction r√©ussie** - Les donn√©es sont bien extraites
4. **Donn√©es de l'√©quipe** - Nom, logo, cat√©gorie, etc.

### ‚ùå Probl√®mes courants :

**Probl√®me :** `Team ID: undefined`
```
‚ùå [DASHBOARD] Aucun team_id trouv√©!
```
**Solution :** L'utilisateur n'a pas de `team_id`. V√©rifier que le login retourne bien ce champ.

**Probl√®me :** Erreur 404
```
‚ùå [DASHBOARD] Status: 404
‚ùå [DASHBOARD] Message: Not Found
```
**Solution :** L'√©quipe n'existe pas dans la base de donn√©es. V√©rifier l'ID.

**Probl√®me :** Erreur 401
```
‚ùå [DASHBOARD] Status: 401
‚ùå [DASHBOARD] Message: Unauthorized
```
**Solution :** Le token JWT n'est pas envoy√© ou est invalide. V√©rifier l'interceptor.

---

## ‚öΩ Logs des Matchs

### Chargement des matchs

```
‚öΩ [MATCHS] Chargement des matchs du coach
üë§ [MATCHS] Current User: { ... }
üèüÔ∏è [MATCHS] Team ID: "team-456"
üîÑ [MATCHS] Appel API GET /teams/team-456/matches
```

### Service MatchService

```
üîÑ [MATCH SERVICE] GET https://.../api/v1/teams/team-456/matches
üìã [MATCH SERVICE] Params: { status: "upcoming" }
üì• [MATCH SERVICE] R√©ponse brute du backend: { status, data, message }
‚úÖ [MATCH SERVICE] Extraction: res.data.data.matches
```

### Traitement des donn√©es

```
‚úÖ [MATCHS] Matchs √† venir re√ßus: [{ id, competition, opponent, ... }]
‚úÖ [MATCHS] Matchs jou√©s re√ßus: [{ ... }]
üìä [MATCHS] Nombre matchs √† venir: 5
üìä [MATCHS] Nombre matchs jou√©s: 12
üì¶ [MATCHS] Total matchs combin√©s: 17
üîÑ [MATCHS] Matchs convertis au format coach: [{ ... }]
üìã [MATCHS] Matchs group√©s par comp√©tition: { "Championnat D1": [...], "Coupe": [...] }
```

### ‚úÖ Que v√©rifier :

1. **Nombre de matchs** - V√©rifier que des matchs sont retourn√©s
2. **Structure des matchs** - Format de chaque match
3. **Conversion r√©ussie** - Les matchs sont bien convertis
4. **Groupement correct** - Matchs group√©s par comp√©tition

### ‚ùå Probl√®mes courants :

**Probl√®me :** Nombre de matchs = 0
```
üìä [MATCHS] Nombre matchs √† venir: 0
üìä [MATCHS] Nombre matchs jou√©s: 0
```
**Solution :** L'√©quipe n'a pas de matchs ou le filtre ne fonctionne pas. V√©rifier les donn√©es.

**Probl√®me :** Structure non reconnue
```
‚ö†Ô∏è [MATCH SERVICE] Aucune structure reconnue, retour tableau vide
```
**Solution :** La structure de r√©ponse du backend est diff√©rente. Noter la structure exacte dans les logs et adapter le code.

**Probl√®me :** Utilisation des donn√©es de mock
```
‚ö†Ô∏è [MATCH SERVICE] Utilisation des donn√©es de mock
```
**Solution :** L'API a √©chou√©, les donn√©es de test sont utilis√©es. V√©rifier l'erreur pr√©c√©dente.

---

## üìñ Comment Utiliser les Logs

### 1. Ouvrir la Console du Navigateur

**Chrome/Edge/Firefox :**
- Appuyez sur `F12`
- Allez dans l'onglet `Console`
- Assurez-vous que tous les niveaux de logs sont activ√©s (Info, Warn, Error)

### 2. Effacer les Logs

```javascript
// Dans la console
console.clear()
```

### 3. Filtrer les Logs

**Filtrer par cat√©gorie :**
```javascript
// Voir uniquement les logs d'authentification
[AUTH]

// Voir uniquement les logs du dashboard
[DASHBOARD]

// Voir uniquement les logs des matchs
[MATCHS]
```

**Filtrer par niveau :**
```javascript
// Voir uniquement les erreurs
‚ùå

// Voir uniquement les succ√®s
‚úÖ

// Voir les appels API
üîÑ
```

### 4. Copier les Logs

1. Clic droit sur un log
2. "Copy message" ou "Copy object"
3. Coller dans un √©diteur de texte

### 5. Examiner un Objet

```javascript
// Dans la console, cliquer sur l'objet pour l'explorer
‚ñ∂ {status: true, data: {...}, message: "succ√®s"}
  ‚ñ∂ data:
    ‚ñ∂ team:
        id: "team-456"
        name: "Mon √âquipe"
        logo: "https://..."
```

---

## üîç Exemples de Sc√©narios

### Sc√©nario 1 : Connexion R√©ussie

```
üîê [AUTH] R√©ponse compl√®te du backend: {status: true, data: {...}}
üë§ [AUTH] User re√ßu: {id: "u123", team_id: "t456", is_coach: true}
üèüÔ∏è [AUTH] Team ID: "t456"
‚úÖ [AUTH] Is Coach: true
üîë [AUTH] Token: Token pr√©sent

üìä [DASHBOARD] Chargement des donn√©es du coach
üèüÔ∏è [DASHBOARD] Team ID √† utiliser: "t456"
üîÑ [DASHBOARD] Appel API GET /teams/t456
üì• [EQUIPE SERVICE] R√©ponse brute du backend: {status: true, data: {...}}
‚úÖ [DASHBOARD] √âquipe re√ßue du backend: {id: "t456", name: "AS Fasofoot"}
```

**‚úÖ R√©sultat :** Connexion r√©ussie, donn√©es charg√©es

---

### Sc√©nario 2 : Team ID Manquant

```
üîê [AUTH] R√©ponse compl√®te du backend: {status: true, data: {...}}
üë§ [AUTH] User re√ßu: {id: "u123", is_coach: true}
üèüÔ∏è [AUTH] Team ID: undefined
‚ö†Ô∏è [AUTH] Team ID manquant dans la r√©ponse!

üìä [DASHBOARD] Chargement des donn√©es du coach
üèüÔ∏è [DASHBOARD] Team ID √† utiliser: undefined
‚ùå [DASHBOARD] Aucun team_id trouv√©!
```

**‚ùå R√©sultat :** √âchec - Le backend ne retourne pas `team_id`

**üîß Solution :** Corriger l'API `/auth/login` pour inclure `team_id` dans l'objet user

---

### Sc√©nario 3 : Structure de R√©ponse Diff√©rente

```
üîÑ [MATCH SERVICE] GET /teams/t456/matches
üì• [MATCH SERVICE] R√©ponse brute du backend: {
  success: true,
  result: {
    matches: [...]
  }
}
‚ö†Ô∏è [MATCH SERVICE] Aucune structure reconnue, retour tableau vide
```

**‚ùå R√©sultat :** Structure non reconnue, aucun match affich√©

**üîß Solution :** Adapter le service pour extraire `res.result.matches` :

```typescript
// Dans match.service.ts
map(res => {
  if (res?.result?.matches) {
    console.log('‚úÖ [MATCH SERVICE] Extraction: res.result.matches');
    return res.result.matches as MatchItem[];
  }
  // ...
})
```

---

## üéØ Checklist de Debug

### √âtape 1 : V√©rifier la Connexion

- [ ] Logs `[AUTH]` pr√©sents
- [ ] `Team ID` d√©fini et non undefined
- [ ] `Is Coach` = true
- [ ] `Token` pr√©sent
- [ ] Structure de l'objet User not√©e

### √âtape 2 : V√©rifier le Dashboard

- [ ] Logs `[DASHBOARD]` pr√©sents
- [ ] `Team ID` correct (m√™me que login)
- [ ] Appel API `/teams/:id` effectu√©
- [ ] R√©ponse du backend re√ßue
- [ ] Donn√©es de l'√©quipe extraites
- [ ] Aucune erreur 404/401

### √âtape 3 : V√©rifier les Matchs

- [ ] Logs `[MATCHS]` pr√©sents
- [ ] Appels API pour matchs √† venir et jou√©s
- [ ] R√©ponses re√ßues du backend
- [ ] Nombre de matchs > 0
- [ ] Conversion au format coach r√©ussie
- [ ] Groupement par comp√©tition OK

### √âtape 4 : Noter les Structures

Copier et sauvegarder les structures exactes :

```javascript
// Structure de l'objet User
{
  id: "...",
  team_id: "...",
  is_coach: true,
  // ... autres champs
}

// Structure de la r√©ponse /teams/:id
{
  status: true,
  data: {
    // ... structure exacte
  }
}

// Structure de la r√©ponse /teams/:id/matches
{
  status: true,
  data: {
    // ... structure exacte
  }
}
```

---

## üìö Documentation Associ√©e

- [IMPLEMENTATION_COACH_REDIRECTION.md](./IMPLEMENTATION_COACH_REDIRECTION.md)
- [INTEGRATION_MATCHS_COACH.md](./INTEGRATION_MATCHS_COACH.md)
- [ENDPOINTS_DISPONIBLES_COACH.md](./ENDPOINTS_DISPONIBLES_COACH.md)
- [CORRECTIONS_FINALES.md](./CORRECTIONS_FINALES.md)

---

## üí° Conseils

1. **Toujours commencer par les logs d'authentification** - Si `team_id` manque ici, tout le reste √©chouera
2. **Copier les structures exactes** - Ne pas deviner, noter exactement ce que le backend retourne
3. **V√©rifier les erreurs HTTP** - 401, 403, 404 donnent des indices sur le probl√®me
4. **Utiliser les √©mojis pour filtrer** - Chercher `‚ùå` pour voir uniquement les erreurs
5. **Prendre des captures d'√©cran** - Pour partager avec l'√©quipe backend si n√©cessaire

---

## ‚úÖ R√©sultat Attendu

Avec une connexion r√©ussie, vous devriez voir cette s√©quence compl√®te :

```
üîê [AUTH] Connexion r√©ussie
üë§ [AUTH] User avec team_id
üìä [DASHBOARD] Chargement √©quipe
‚úÖ [DASHBOARD] √âquipe re√ßue
‚öΩ [MATCHS] Chargement matchs
‚úÖ [MATCHS] X matchs re√ßus
üìã [MATCHS] Matchs group√©s et affich√©s
```

Bon debug ! üöÄ
